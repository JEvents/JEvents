<?xml version="1.0" encoding="UTF-8"?>

<!-- Usage - run  phing -f linker.xml -Dp=/var/www/je -->

<project name="linker" default="link" basedir=".">
    <property name="URI.base" value="./"/>
    <resolvepath propertyName="URI.base" file="${URI.base}"/>
    <property name="p" value="" />
    <property name="component" value="com_jevents"/>
    <property name="rootPath" value="${URI.base}"/>

    <target name="link" description="Build all targets !! ">

        <echo>Current Path: ${rootPath}</echo>
        <echo>Target Path: ${p}</echo>

        <phingcall target="deleteall" />

        <!-- Create System Links -->
        <symlink target="${rootPath}/component/admin" link="${p}/administrator/components/${component}"  overwrite="true" />
        <symlink target="${rootPath}/component/site" link="${p}/components/${component}"  overwrite="true"/>
        <symlink target="${rootPath}/component/media/js" link="${p}/media/${component}/js" overwrite="true" />
        <symlink target="${rootPath}/component/media/css" link="${p}/media/${component}/css" overwrite="true" />
        <symlink target="${rootPath}/component/media/images" link="${p}/media/${component}/images" overwrite="true" />
        <symlink target="${rootPath}/plugins/finder/jevents" link="${p}/plugins/finder/jevents" overwrite="true" />
        <symlink target="${rootPath}/plugins/search/" link="${p}/plugins/search/eventsearch" overwrite="true" />
        <symlink target="${rootPath}/plugins/installer" link="${p}/plugins/installer/jeventsinstaller" overwrite="true" />
        <symlink target="${rootPath}/plugins/jevents" link="${p}/plugins/content/jevents" overwrite="true" />
        <symlink target="${rootPath}/plugins/gwejson" link="${p}/plugins/system/gwejson" overwrite="true" />
        <symlink target="${rootPath}/libraries/googl" link="${p}/libraries/googl" overwrite="true" />
        <symlink target="${rootPath}/libraries/jevmodal" link="${p}/libraries/jevents/jevmodal" overwrite="true" />
        <symlink target="${rootPath}/libraries/jevbootstrap" link="${p}/libraries/jevents/bootstrap" overwrite="true" />
        <symlink target="${rootPath}/libraries/jevtypeahead" link="${p}/libraries/jevents/jevtypeahead" overwrite="true" />
        <symlink target="${rootPath}/modules/mod_jevents_cal" link="${p}/modules/mod_jevents_cal" overwrite="true" />
        <symlink target="${rootPath}/modules/mod_jevents_custom" link="${p}/modules/mod_jevents_custom" overwrite="true" />
        <symlink target="${rootPath}/modules/mod_jevents_filter" link="${p}/modules/mod_jevents_filter" overwrite="true" />
        <symlink target="${rootPath}/modules/mod_jevents_latest" link="${p}/modules/mod_jevents_latest" overwrite="true" />
        <symlink target="${rootPath}/modules/mod_jevents_legend" link="${p}/modules/mod_jevents_legend" overwrite="true" />
        <symlink target="${rootPath}/modules/mod_jevents_switchview" link="${p}/modules/mod_jevents_switchview" overwrite="true" />

        <!-- Language System Links -->
        <symlink target="${rootPath}/component/admin/language/en-GB.${component}.ini" link="${p}/administrator/language/en-GB/en-GB.${component}.ini" overwrite="true" />
        <symlink target="${rootPath}/component/admin/language/en-GB.${component}.sys.ini" link="${p}/administrator/language/en-GB/en-GB.${component}.sys.ini" overwrite="true" />
        <symlink target="${rootPath}/component/admin/language/en-GB.${component}.menu.ini" link="${p}/administrator/language/en-GB/en-GB.${component}.menu.ini" overwrite="true" />
        <symlink target="${rootPath}/component/admin/language/en-GB.jev_package_title.ini" link="${p}/administrator/language/en-GB/en-GB.jev_package_title.ini" overwrite="true" />
        <symlink target="${rootPath}/component/site/language/en-GB.${component}.ini" link="${p}/language/en-GB/en-GB.${component}.ini" overwrite="true" />

        <symlink target="${rootPath}/modules/mod_jevents_cal/language/en-GB/en-GB.mod_jevents_cal.ini" link="${p}/language/en-GB/en-GB.mod_jevents_cal.ini" overwrite="true" />
        <symlink target="${rootPath}/modules/mod_jevents_cal/language/en-GB/en-GB.mod_jevents_cal.sys.ini" link="${p}/language/en-GB/en-GB.mod_jevents_cal.sys.ini" overwrite="true" />
        <symlink target="${rootPath}/modules/mod_jevents_custom/language/en-GB/en-GB.mod_jevents_custom.ini" link="${p}/language/en-GB/en-GB.mod_jevents_custom.ini" overwrite="true" />
        <symlink target="${rootPath}/modules/mod_jevents_custom/language/en-GB/en-GB.mod_jevents_custom.sys.ini" link="${p}/language/en-GB/en-GB.mod_jevents_custom.sys.ini" overwrite="true" />
        <symlink target="${rootPath}/modules/mod_jevents_filter/language/en-GB/en-GB.mod_jevents_filter.ini" link="${p}/language/en-GB/en-GB.mod_jevents_filter.ini" overwrite="true" />
        <symlink target="${rootPath}/modules/mod_jevents_filter/language/en-GB/en-GB.mod_jevents_filter.sys.ini" link="${p}/language/en-GB/en-GB.mod_jevents_filter.sys.ini" overwrite="true" />
        <symlink target="${rootPath}/modules/mod_jevents_latest/language/en-GB/en-GB.mod_jevents_latest.ini" link="${p}/language/en-GB/en-GB.mod_jevents_latest.ini" overwrite="true" />
        <symlink target="${rootPath}/modules/mod_jevents_latest/language/en-GB/en-GB.mod_jevents_latest.sys.ini" link="${p}/language/en-GB/en-GB.mod_jevents_latest.sys.ini" overwrite="true" />
        <symlink target="${rootPath}/modules/mod_jevents_legend/language/en-GB/en-GB.mod_jevents_legend.ini" link="${p}/language/en-GB/en-GB.mod_jevents_legend.ini" overwrite="true" />
        <symlink target="${rootPath}/modules/mod_jevents_legend/language/en-GB/en-GB.mod_jevents_legend.sys.ini" link="${p}/language/en-GB/en-GB.mod_jevents_legend.sys.ini" overwrite="true" />
        <symlink target="${rootPath}/modules/mod_jevents_switchview/language/en-GB/en-GB.mod_jevents_switchview.ini" link="${p}/language/en-GB/en-GB.mod_jevents_switchview.ini" overwrite="true" />
        <symlink target="${rootPath}/modules/mod_jevents_switchview/language/en-GB/en-GB.mod_jevents_switchview.sys.ini" link="${p}/language/en-GB/en-GB.mod_jevents_switchview.sys.ini" overwrite="true" />

        <symlink target="${rootPath}/plugins/finder/jevents/language/en-GB.plg_finder_jevents.ini" link="${p}/administrator/language/en-GB/en-GB.plg_finder_jevents.ini" overwrite="true" />
        <symlink target="${rootPath}/plugins/finder/jevents/language/en-GB.plg_finder_jevents.sys.ini" link="${p}/administrator/language/en-GB/en-GB.plg_finder_jevents.sys.ini" overwrite="true" />
        <symlink target="${rootPath}/plugins/gwejson/language/en-GB/en-GB.plg_system_gwejson.ini" link="${p}/administrator/language/en-GB/en-GB.plg_system_gwejson.ini" overwrite="true" />
        <symlink target="${rootPath}/plugins/gwejson/language/en-GB/en-GB.plg_system_gwejson.sys.ini" link="${p}/administrator/language/en-GB/en-GB.plg_system_gwejson.sys.ini" overwrite="true" />
        <symlink target="${rootPath}/plugins/installer/language/en-GB/en-GB.plg_installer_jeventsinstaller.ini" link="${p}/administrator/language/en-GB/en-GB.plg_installer_jeventsinstaller.ini" overwrite="true" />
        <symlink target="${rootPath}/plugins/installer/language/en-GB/en-GB.plg_installer_jeventsinstaller.sys.ini" link="${p}/administrator/language/en-GB/en-GB.plg_installer_jeventsinstaller.sys.ini" overwrite="true" />
        <symlink target="${rootPath}/plugins/jevents/language/en-GB/en-GB.plg_content_jevents.ini" link="${p}/administrator/language/en-GB/en-GB.plg_content_jevents.ini" overwrite="true" />
        <symlink target="${rootPath}/plugins/jevents/language/en-GB/en-GB.plg_content_jevents.sys.ini" link="${p}/administrator/language/en-GB/en-GB.plg_content_jevents.sys.ini" overwrite="true" />
        <symlink target="${rootPath}/plugins/search/language/en-GB/en-GB.plg_search_eventsearch.ini" link="${p}/administrator/language/en-GB/en-GB.plg_search_eventsearch.ini" overwrite="true" />
        <symlink target="${rootPath}/plugins/search/language/en-GB/en-GB.plg_search_eventsearch.ini" link="${p}/administrator/language/en-GB/en-GB.plg_search_eventsearch.sys.ini" overwrite="true" />

    </target>

    <target name="deleteall">
        <!-- Delete folders and files, even if symlinks -->
           <foreach param="filename" target="deleteitem" >
                <filelist dir="/" files="
                        ${p}/administrator/components/${component}/, 
                        ${p}/components/${component}/, 
                        ${p}/plugins/finder/jevents/,
                        ${p}/plugins/system/gwejson/,
                        ${p}/plugins/search/eventsearch/,
                        ${p}/plugins/installer/jeventsinstaller/,
                        ${p}/plugins/content/jevents/,
                        ${p}/media/${component}/css/,
                        ${p}/media/${component}/js/,
                        ${p}/media/${component}/images/,
                        ${p}/libraries/googl/,
                        ${p}/libraries/jevents/jevmodal/,
                        ${p}/libraries/jevents/jevbootstrap/,
                        ${p}/libraries/jevents/jevtypeahead/,
                        ${p}/modules/mod_jevents_cal/,
                        ${p}/modules/mod_jevents_custom/,
                        ${p}/modules/mod_jevents_filter/,
                        ${p}/modules/mod_jevents_latest/,
                        ${p}/modules/mod_jevents_legend/,
                        ${p}/modules/mod_jevents_switchview/,
                        ${p}/administrator/language/en-GB/en-GB.${component}.ini,
                        ${p}/administrator/language/en-GB/en-GB.${component}.sys.ini,
                        ${p}/administrator/language/en-GB/en-GB.${component}.menu.ini,
                        ${p}/administrator/language/en-GB/en-GB.jev_package_title.ini,
                        ${p}/language/en-GB/en-GB.${component}.ini,
                        ${p}/language/en-GB/en-GB.mod_jevents_cal.ini,
                        ${p}/language/en-GB/en-GB.mod_jevents_cal.sys.ini,
                        ${p}/language/en-GB/en-GB.mod_jevents_custom.ini,
                        ${p}/language/en-GB/en-GB.mod_jevents_custom.sys.ini,
                        ${p}/language/en-GB/en-GB.mod_jevents_filter.ini,
                        ${p}/language/en-GB/en-GB.mod_jevents_filter.sys.ini,
                        ${p}/language/en-GB/en-GB.mod_jevents_latest.ini,
                        ${p}/language/en-GB/en-GB.mod_jevents_latest.sys.ini,
                        ${p}/language/en-GB/en-GB.mod_jevents_legend.ini,
                        ${p}/language/en-GB/en-GB.mod_jevents_legend.sys.ini,
                        ${p}/language/en-GB/en-GB.mod_jevents_switchview.ini,
                        ${p}/language/en-GB/en-GB.mod_jevents_switchview.sys.ini,
                        ${p}/administrator/language/en-GB/en-GB.plg_finder_jevents.ini,
                        ${p}/administrator/language/en-GB/en-GB.plg_finder_jevents.sys.ini,
                        ${p}/administrator/language/en-GB/en-GB.plg_system_gwejson.ini,
                        ${p}/administrator/language/en-GB/en-GB.plg_system_gwejson.sys.ini,
                        ${p}/administrator/language/en-GB/en-GB.plg_installer_jeventsinstaller.ini,
                        ${p}/administrator/language/en-GB/en-GB.plg_installer_jeventsinstaller.sys.ini,
                        ${p}/administrator/language/en-GB/en-GB.plg_content_jevents.ini,
                        ${p}/administrator/language/en-GB/en-GB.plg_content_jevents.sys.ini,
                        ${p}/administrator/language/en-GB/en-GB.plg_search_eventsearch.ini,
                        ${p}/administrator/language/en-GB/en-GB.plg_search_eventsearch.sys.ini,
                        " />
            </foreach>
    </target>

    <target name="deleteitem">
        <!-- we have to do some magic in here as symlinks directories don't report unless we follow them, BUT, they report as a dir but need to be deleted as a file -->
        <if><available file="${filename}" type="file" />
            <then><delete file="${filename}" verbose="true" failonerror="false" /></then>
        </if>
        <if><available file="${filename}" type="dir" />
            <then><delete dir="${filename}" includeemptydirs="true" verbose="false" failonerror="false" /></then>
        </if>
        <if><available file="${filename}" type="dir" followSymlinks="true"/>
            <then><delete file="${filename}" verbose="true" failonerror="false" /></then>
        </if>
        <if><available file="${filename}" type="file" followSymlinks="true"/>
            <then><delete file="${filename}" verbose="true" failonerror="false" /></then>
        </if>
     </target>

    <target name="unlink" description="Restore all jevents bits">
        <property name="URI.base" value="./"/>
        <resolvepath propertyName="URI.base" file="${URI.base}"/>
        <property name="p" value="" />
        <property name="component" value="com_jevents"/>
        <property name="rootPath" value="${URI.base}"/>

        <phingcall target="deleteall" />

       <!-- Copy the directories -->
        <phingcall target="copydir"><property name="to" value="${p}/administrator/components/${component}"/><property name="from" value="${rootPath}/component/admin"/></phingcall>
        <phingcall target="copydir"><property name="to" value="${p}/components/${component}"/><property name="from" value="${rootPath}/component/site"/></phingcall>
        <phingcall target="copydir"><property name="to" value="${p}/media/${component}/js"/><property name="from" value="${rootPath}/component/media/js"/></phingcall>
        <phingcall target="copydir"><property name="to" value="${p}/media/${component}/css"/><property name="from" value="${rootPath}/component/media/css"/></phingcall>
        <phingcall target="copydir"><property name="to" value="${p}/media/${component}/images"/><property name="from" value="${rootPath}/component/media/images"/></phingcall>
        <phingcall target="copydir"><property name="to" value="${p}/plugins/finder/jevents/"/><property name="from" value="${rootPath}/plugins/finder/jevents"/></phingcall>
        <phingcall target="copydir"><property name="to" value="${p}/plugins/search/eventsearch/"/><property name="from" value="${rootPath}/plugins/search/"/></phingcall>
        <phingcall target="copydir"><property name="to" value="${p}/plugins/installer/jeventsinstaller/"/><property name="from" value="${rootPath}/plugins/installer"/></phingcall>
        <phingcall target="copydir"><property name="to" value="${p}/plugins/content/jevents/"/><property name="from" value="${rootPath}/plugins/jevents"/></phingcall>
        <phingcall target="copydir"><property name="to" value="${p}/plugins/system/gwejson/"/><property name="from" value="${rootPath}/plugins/gwejson"/></phingcall>
        <phingcall target="copydir"><property name="to" value="${p}/libraries/googl/"/><property name="from" value="${rootPath}/libraries/googl"/></phingcall>
        <phingcall target="copydir"><property name="to" value="${p}/libraries/jevents/jevmodal/"/><property name="from" value="${rootPath}/libraries/jevmodal"/></phingcall>
        <phingcall target="copydir"><property name="to" value="${p}/libraries/jevents/bootstrap/"/><property name="from" value="${rootPath}/libraries/jevbootstrap"/></phingcall>
        <phingcall target="copydir"><property name="to" value="${p}/libraries/jevents/jevtypeahead/"/><property name="from" value="${rootPath}/libraries/jevtypeahead"/></phingcall>
        <phingcall target="copydir"><property name="to" value="${p}/modules/mod_jevents_cal/"/><property name="from" value="${rootPath}/modules/mod_jevents_cal"/></phingcall>
        <phingcall target="copydir"><property name="to" value="${p}/modules/mod_jevents_custom/"/><property name="from" value="${rootPath}/modules/mod_jevents_custom"/></phingcall>
        <phingcall target="copydir"><property name="to" value="${p}/modules/mod_jevents_filter/"/><property name="from" value="${rootPath}/modules/mod_jevents_filter"/></phingcall>
        <phingcall target="copydir"><property name="to" value="${p}/modules/mod_jevents_latest/"/><property name="from" value="${rootPath}/modules/mod_jevents_latest"/></phingcall>
        <phingcall target="copydir"><property name="to" value="${p}/modules/mod_jevents_legend/"/><property name="from" value="${rootPath}/modules/mod_jevents_legend"/></phingcall>
        <phingcall target="copydir"><property name="to" value="${p}/modules/mod_jevents_switchview/"/><property name="from" value="${rootPath}/modules/mod_jevents_switchview"/></phingcall>

        <!-- Copy the language files -->
        <copy file="${rootPath}/component/admin/language/en-GB.${component}.ini" todir="${p}/administrator/language/en-GB/" overwrite="true" />
        <copy file="${rootPath}/component/admin/language/en-GB.${component}.sys.ini" todir="${p}/administrator/language/en-GB/" overwrite="true" />
        <copy file="${rootPath}/component/admin/language/en-GB.${component}.menu.ini" todir="${p}/administrator/language/en-GB/" overwrite="true" />
        <copy file="${rootPath}/component/admin/language/en-GB.jev_package_title.ini" todir="${p}/administrator/language/en-GB/" overwrite="true" />
        <copy file="${rootPath}/component/site/language/en-GB.${component}.ini" todir="${p}/language/en-GB/" overwrite="true" />

        <copy file="${rootPath}/modules/mod_jevents_cal/language/en-GB/en-GB.mod_jevents_cal.ini" todir="${p}/language/en-GB/" overwrite="true" />
        <copy file="${rootPath}/modules/mod_jevents_cal/language/en-GB/en-GB.mod_jevents_cal.sys.ini" todir="${p}/language/en-GB/" overwrite="true" />
        <copy file="${rootPath}/modules/mod_jevents_custom/language/en-GB/en-GB.mod_jevents_custom.ini" todir="${p}/language/en-GB/" overwrite="true" />
        <copy file="${rootPath}/modules/mod_jevents_custom/language/en-GB/en-GB.mod_jevents_custom.sys.ini" todir="${p}/language/en-GB/" overwrite="true" />
        <copy file="${rootPath}/modules/mod_jevents_filter/language/en-GB/en-GB.mod_jevents_filter.ini" todir="${p}/language/en-GB/" overwrite="true" />
        <copy file="${rootPath}/modules/mod_jevents_filter/language/en-GB/en-GB.mod_jevents_filter.sys.ini" todir="${p}/language/en-GB/" overwrite="true" />
        <copy file="${rootPath}/modules/mod_jevents_latest/language/en-GB/en-GB.mod_jevents_latest.ini" todir="${p}/language/en-GB/" overwrite="true" />
        <copy file="${rootPath}/modules/mod_jevents_latest/language/en-GB/en-GB.mod_jevents_latest.sys.ini" todir="${p}/language/en-GB/" overwrite="true" />
        <copy file="${rootPath}/modules/mod_jevents_legend/language/en-GB/en-GB.mod_jevents_legend.ini" todir="${p}/language/en-GB/" overwrite="true" />
        <copy file="${rootPath}/modules/mod_jevents_legend/language/en-GB/en-GB.mod_jevents_legend.sys.ini" todir="${p}/language/en-GB/" overwrite="true" />
        <copy file="${rootPath}/modules/mod_jevents_switchview/language/en-GB/en-GB.mod_jevents_switchview.ini" todir="${p}/language/en-GB/" overwrite="true" />
        <copy file="${rootPath}/modules/mod_jevents_switchview/language/en-GB/en-GB.mod_jevents_switchview.sys.ini" todir="${p}/language/en-GB/" overwrite="true" />

        <copy file="${rootPath}/plugins/finder/jevents/language/en-GB.plg_finder_jevents.ini" todir="${p}/administrator/language/en-GB/" overwrite="true" />
        <copy file="${rootPath}/plugins/finder/jevents/language/en-GB.plg_finder_jevents.sys.ini" todir="${p}/administrator/language/en-GB/" overwrite="true" />
        <copy file="${rootPath}/plugins/gwejson/language/en-GB/en-GB.plg_system_gwejson.ini" todir="${p}/administrator/language/en-GB/" overwrite="true" />
        <copy file="${rootPath}/plugins/gwejson/language/en-GB/en-GB.plg_system_gwejson.sys.ini" todir="${p}/administrator/language/en-GB/" overwrite="true" />
        <copy file="${rootPath}/plugins/installer/language/en-GB/en-GB.plg_installer_jeventsinstaller.ini" todir="${p}/administrator/language/en-GB/" overwrite="true" />
        <copy file="${rootPath}/plugins/installer/language/en-GB/en-GB.plg_installer_jeventsinstaller.sys.ini" todir="${p}/administrator/language/en-GB/" overwrite="true" />
        <copy file="${rootPath}/plugins/jevents/language/en-GB/en-GB.plg_content_jevents.ini" todir="${p}/administrator/language/en-GB/" overwrite="true" />
        <copy file="${rootPath}/plugins/jevents/language/en-GB/en-GB.plg_content_jevents.sys.ini" todir="${p}/administrator/languageen-GB/" overwrite="true" />
        <copy file="${rootPath}/plugins/search/language/en-GB/en-GB.plg_search_eventsearch.ini" todir="${p}/administrator/language/en-GB/" overwrite="true" />
        <copy file="${rootPath}/plugins/search/language/en-GB/en-GB.plg_search_eventsearch.ini" todir="${p}/administrator/language/en-GB/" overwrite="true" />
    </target>

    <target name="copydir">
        <!-- First make the directory in case it doesn't exist -->
        <echo>Copy Directory from: ${from}, to: ${to}</echo>
        <mkdir dir="${to}" />
        <copy todir="${to}">
            <fileset dir="${from}">
                <include name="**"></include>
                <exclude name="**/.svn/**"></exclude>
                <exclude name="**/*.zip"></exclude>
            </fileset>
        </copy>
    </target>

</project>
